
'ALLNONREC'


'ACTION' TURN TO,

TURN TO+X+S:
        TEST+S,(IS NOT  +X,TURN+S;);
                IS      +X,TURN+S;.


[    GLOBALIS MENNYISEGEK    ]

'CHECK'

'MACRO' 'POINTER' MINFORM=1000, MXFORM=3000,MINVALT = 0, MXVALT=150,
    MINAZ=1,MAXAZ=100.
'LIST' LFORM[MINFORM:MXFORM], LVALT[0:MXVALT],LAZ[MINAZ:MAXAZ].

'FLAG'BESZAKITAS,

'MACRO''POINTER'KARELTOLAS=300000,MAXKAR=300256,
'MACRO''POINTER'SZAMELTOLAS=4000000,FIXMERET = 5,

'POINTER' MAXFORM,MAXVALT,ELOJELKONV.
'POINTER' PVALT, PFORM,ELLENORZESI SZINT,KOVETESI SZINT,VALT BAZIS,XFORM,HIBASZINT.
'TERMINAL'
        OPERATORJEL,BALROL JOBBRA,JOBBROL BALRA,
        FONTJEL.
'TERMINAL' PONTJEL, CSILLAGJEL, PLUSZJEL,MINUSZJEL, NYITOJEL, VESSZOJEL,
           VEGZAROJEL, FINJEL, SZINT, LVALT BETELT, LFORM BETELT,
           SZINTJEL.

'MACRO''POINTER'
        MIN SZC = 998,
        MAX SZC =1030,
        MAX HELY = 32,
        X NAGY SZC=1031,
        MIN FFORM =1032,
        MIN HOSSZ =200 000,
        EGY HOSSZU =200 001,
        KETTO HOSSZU =200 002.

'MACRO''POINTER'
        LL MERET = 2,KLOZ ADMIN = 1,OP ADMIN = 2,MAX ADMIN = 2,
        KL MERET = 5,

'POINTER'
        XRSZ,PRSZ,URSZ,ARSZ,ALL,MELYSEG,VALT RSZ.
'TERMINAL'
        HIBAS UTASITAS,RSZ BETELT,HIBAS LITERAL, XJEL.
'TERMINAL'
        GENJEL.

'TERMINAL'
        KERDOJEL.
'TERMINAL'
        IDOPONT,MEGSZAKADT,VIGYAZAT,
        MPERC,KHIVAS,MEGHIVTA A,SORSZAMU KLOZT,RSZ CIMFELIRAT,ATUTALASJEL,
        KONSJEL,NILJEL,DEFINIALATLAN,NEMNUMERIKUS,NEMNUMKAR,
        NEMKARAKTER,NEMLITERAL,NEMKLOZ,NEMAZONOSITO,HOSSZUAZ,MEGHIUSULT,
        HIBAS TERM,IDOLEJART,TUL NAGY VISSZALEPES,SIKERULT,NEM FUZER.

'MACRO''POINTER'
        MIN STAND = 1000000,
        MIN RSZ   =   50000, MX RSZ =   51000,
        MAX VALT CIM= 499.
'MACRO''POINTER'
        MIN GEN KONS = 2 000 000,
        MX HIVAS    = 10 000.

'POINTER'
        PGEN KONS.

'FLAG'
        VEGE,INPUT LISTA.

'FLAG' NYOMTATORA,FELH NYOMTATORA,FELHKONZOLRA.
'LIST'
        LRSZ[MIN RSZ:MX RSZ].
'POINTER'
        MAX RSZ,KEZDO IDO,HIVASSZAMLALO,MAX HIVAS,UTOLSO SIKERTELEN,
       INP ROGZITES,RSTO SIZE,MAX SYMBCOUNT.
'NOCHECK'




    [    ALAPVETO ELJARASOK    ]



'ACTION' GET KLL, GET HIVO RSZ, GET HIVO LL,SIKER KOVETESE,
        GET URSZ,GET MELYSEG,GET HELYIGENY,
        GET SORSZAMA,GET ELLENORZES,GET LIT,KIERTEKEL,
        ATUTALASOK KEZDETE,VISSZADMIN,VISSZATERES,
        KOVKLOZ,KOVARG,GETNARG,STACK RSZ,VALT URIT.

GET SORSZAMA+KL+N-X:
        ADD+KL+3+X,GET+LFORM+X+N.
GET NARG+X+N-Z:
        SUBTR+X+1+Z,GET+LFORM+Z+N.

VALT URIT+X-Y:
        MAKE+Y+X,
            ISM: (EQUAL+Y+0;
                  SUBTR+Y+2+Y,INCR+PRSZ,PUT+L RSZ+ P RSZ+MARKER,INCR+PRSZ,:ISM).

GET HELYIGENY+KL+X:
        ADD+KL+2+X,GET+LFORM+X+X.

RSZ HELYIGENYLES+X-Z:
        ADD+P RSZ+X+Z,MAX+XRSZ+Z+XRSZ, LSEQ+Z+MAX RSZ;
        RSZ KITERJESZTES.

STACK RSZ+X:
        PUT+L RSZ+P RSZ+X,INCR+PRSZ.

KOV LITERAL:
        GET+LFORM+A LL+A LL,NONEQUAL+A LL+0.

KIKERES+KLL+JEL+HAT+HRSZ+AT-LIT-LL:
   ISM: NONEQUAL+KLL+0, GET+LFORM+KLL+LL, GET LIT+LL+LIT,
          (MARKED+JEL, 'NOT'MARKED+LIT, MAKE +AT+LIT,EGYEZO ARGSZAMU+AT+HAT;
           MARKED+LIT, 'NOT'MARKED+JEL, UNMARK+LIT+AT,EGYEZO ARGSZAMU+AT+HAT;
           KOV KLOZ +KLL,:ISM).

EGYEZO ARGSZAMU+AT+HAT-N:
        AZONOS FVEK+AT+HAT+N;
        EQUAL+AT+HAT.

KOV KLOZ+KLL:
        INCR+KLL, GET+LFORM +KLL+ KLL.

GET LIT+X+Y-Z:
        ADD+X+1+Z, GET+LFORM + Z + Y,

FVNEVE+AT+F:
        LSEQ+ MIN FORM + AT, LSEQ + AT + MAX FORM, GET + LFORM + AT + F.

VALT+Y:
        LESS+0+Y,LESS+Y+MAX VALT CIM.

KIERTEKEL +A1 +R1 +A2 +R2 -V2 -W2 -X:
        MAKE+R2+R1, MAKE+A2+A1,
          ISM: (VALT+A2, ADD+A2+R2+V2, ADD+V2+1+W2, GET+LRSZ+W2+X,
                   (MARKED+X;
                    GET+LRSZ+V2+A2,MAKE+R2+X,:ISM);
               ).

KOV ARG +X +Y:
        INCR+X, GET+LFORM+X+Y.

ATUTAL+V1+R1+A2+R2-X:
        NEM TARTALMAZZA1+V1+R1+A2+R2,
        ADD+V1+R1+X, PUT+L RSZ+X+A2, INCR+X, PUT+LRSZ+X+R2,
           (EQUAL+R1+ARSZ;
            STACK RSZ+X,RSZ HELYIGENYLES+1).

NEM TARTALMAZZA1+V1+R1+A2+R2:
        TEST+9,(NEM TARTALM+V1+R1+A2+R2);.

AZONOS FVEK+A3+A4+N-F3-F4-N1:
        FVNEVE+A3+F3,FVNEVE+A4+F4,EQUAL+F3+F4,
         GET NARG+A3+N,GET NARG+A4+N1,EQUAL+N+N1.

GET KLL+RSZ+X:
        GET+L RSZ+RSZ+X.

GET HIVO LL+RSZ+X-Y:
        ADD+RSZ+2+Y,GET+LRSZ+Y+X.

GET HIVO RSZ+RSZ+X-Y:
        ADD+RSZ+1+Y,GET+LRSZ+Y+X.

GET URSZ   +RSZ+X-Y:
        ADD+RSZ+3+Y,GET+LRSZ+Y+X.

GET MELYSEG +RSZ+X-Y:
        ADD+RSZ+4+Y,GET+LRSZ+Y+Y,UNMARK+Y+X.

TORLENDO KLOZ+RSZ-Y:
          ADD+RSZ+4+Y,GET+LRSZ+Y+Y,MARKED+Y.

GET ELLENORZES+KL+X-Y:
        ADD+KL+4+Y,GET+LFORM+Y+X.

ATUTALASOK KEZDETE+P+Q-X:
        GET KLL+P+X,GET HELYIGENY+X+X,ADD+P+X+Q.

KONSTANS+X:
        MARKED+X;
        LSEQ+MINTAG+X.

HIBA VOLT:
        TEST+1;IS+BESZAITAS.

VEGRE VEGE:
        EQUAL+ARSZ+0.

SZABANYOS+X:
       LESS+MIN STAND+X.

ADMIN+X-Y:
        GET HELYIGENY+X+Y, RSZ HELYIGENYLES+Y,INCR+MELYSEG,
          STACK RSZ+X, STACK RSZ+A RSZ,STACK RSZ+A LL,STACK RSZ+U RSZ,
          STACK RSZ+MELYSEG,SUBTR+PRSZ+FIXMERET+ARSZ, MAKE+U RSZ+A RSZ,MAKE+ ALL+X,
          SUBTR+Y+FIXMERET+Y,VALT URIT+Y.

VISSZATERES:
        SIKER KOVETESE,GET HIVO LL+ARSZ+A LL, GET HIVO RSZ+A RSZ+A RSZ,
        DECR+MELYSEG.

VISSZADMIN:
          MAKE+PRSZ+URSZ,GET URSZ+PRSZ+URSZ,GET HIVO LL+PRSZ+ALL,
          GET HIVO RSZ+PRSZ+ARSZ,GET MELYSEG+PRSZ+MELYSEG.

EGYSZERU VISSZALEPES-X:
        ATUTALASOK KEZDETE+URSZ+X,EQUAL+X+PRSZ,
           VISSZADMIN.




$
EGYESITHETO1+ A1 +R3 +A2 +R4 -A3 -A4 -F3 -F4 -N:
        KONSTANS+A1,(EQUAL+A1+A2);
        MAKE+A3+A1,MAKE+A4+A2,GET NARG+A1+N,
                   ISM:(LSEQ+N+1;
                        KOV ARG +A3 +F3, KOV ARG +A4 +F4, DECR + N,
                          EGYESITHETO+ F3+R3 +F4 +R4,:ISM)).
$

$HATEKONYSAGI MEGFONTOLASOKBOL: $

EGYESITHETO1+B1+R1+B2+R2-A1-A2-A3-A4-B3-B4-R3-R4-F3-F4-N-M:
        KONSTANS+B1,(EQUAL+B1+B2);
        MAKE+B3+B1,MAKE+B4+B2,GET NARG+B3+N,
         ISM:(LSEQ+N+1;
              KOV ARG+B3+A1,KOV ARG+B4+A2,DECR+N,
              KIERTEKEL+A1+R1+A3+R3,
              KIERTEKEL+A2+R2+A4+R4,
               (VALT+A3,
                   (EQUAL+A3+A4,EQUAL+R3+R4,:ISM;
                    ATUTAL+A3+R3+A4+R4,:ISM);
                VALT+A4,
                   (ATUTAL+A4+R4+A3+R3,:ISM);
                KONSTANS+A3,
                   (EQUAL+A3+A4,:ISM);
                AZONOS FVEK+A3+A4+M,
                  ISM1:(LSEQ+M+1,:ISM;
                        KOV ARG+A3+F3,KOV ARG+A4+F4,DECR+M,
                           EGYESITHETO+F3+R3+F4+R4,:ISM1))).



[BEOLVASO RESZ   ]


'ACTION'  KLOZFUZES,  ELOJELINTEZES, VALTKEZDES,TAROL,HIBAINTEZES, PUT KLL,
         SZAMKONVERTALAS,PUT SORSZAMA,RESZFELSZABADITAS,
        KLOZATNEZES,KLOZTOLDAS,KLOZSZAMOZAS,KONSTANSELINTEZES,
         KOMMENT,  BEALLITASOK,ELSO LITERAL FVNEVE,B HIBA,SORHUZAS,
        ELOJEL ELL,PONT ELL.

'ACTION'
        BEALLITASOK,FELSZABADITAS,KLOZFELSZABADITAS,
        ATOMFELSZABADITAS,LITFELSZABADITAS,
        ELOTTE SZABAD,UTANA SZABAD,
        SZC KAPCSOLASA,SZC TORLESE,GET HOSSZ,PUT HOSSZ,
        SZC FELVETELE ,SZC LISTA,KONZOLRA F SZERINT.

KLOZFELSZABADITAS+KL-LL:
        GET+LFORM+KL+LL,FELSZABADITAS+KL+KLMERET,LITFELSZABADITAS+LL.

LITFELSZABADITAS+LL-LIT-LL1:
    ISM: (EQUAL+LL+0;
          GET LIT+LL+LIT,UNMARK+LIT+LIT,ATOMFELSZABADITAS+LIT,
          MAKE+LL1+LL,GET+LFORM+LL+LL,FELSZABADITAS+LL1+LLMERET,:ISM).

'RS' ATOMFELSZABADITAS+A-F-N:
        FVNEVE+A+F,GET NARG+A+N,RESZFELSZABADITAS+A+N;.

'RS' RESZFELSZABADITAS+A+M-A1-F-N:
        MAKE+N+M,MAKE+F+A,
    ISM: (LSEQ+N+1,SUBTR+A+1+F,GET NARG+A+N,INCR+N,FELSZABADITAS+F+N;
          DECR+N,KOV ARG+F+A1,ATOMFELSZABADITAS+A1,:ISM).

FORM HELY+X+N:
        ADD+PFORM+N+PFORM,MAX+PFORM+XFORM+XFORM,
         PONT JO SZC+X+N;
         NAGY SZC+X+N;
         EGYEB SZC+X+N;
         KITERJESZTES,NAGY SZC+X+N;
         SUSPEND+'NS',KITERJESZTES,NAGY SZC+X+N;
                      B HIBA+LFORM BETELT,KONZOLRA F SZERINT,
                      SET+BESZAKITAS+TRUE,(FALSE).

KITERJESZTES-Y:
        MAKE+Y+MAXFORM,EXTEND+LFORM+512+MAXFORM,PUT+LFORM+MAXFORM+0,
         FELSZABADITAS+Y+512,ADD+PFORM+512+PFORM.

PONT JO SZC+X+N-Y:
        ADD+MIN SZC+N+Y,LSEQ+Y+MAX SZC,GET+LFORM+Y+X,NONEQUAL+X+0,
          SZC TORLESE+X.

NAGY SZC+X+N-Y-M:
        GET+LFORM+X NAGY SZC+Y,
          ISM:(EQUAL+Y+0,(FALSE);
               GET HOSSZ+Y+M,
                LESS+M+N,GET+LFORM+Y+Y,:ISM;
                SUBTR+M+N+M,ADD+Y+M+X,
                 LSEQ+M+MAXHELY,SZC TORLESE+Y,SZC FELVETELE+Y+M;
                 PUT HOSSZ+Y+M).

EGYEB SZC+X+N-P-Y-M:
        MAKE+Y+MAX SZC,ADD+MIN SZC+N+P,
         ISM:(LESS+P+Y,GET+LFORM+Y+X,
               (EQUAL+X+0,DECR+Y,:ISM;
                SZC TORLESE+X,GET HOSSZ+X+M,SUBTR+M+N+M,ADD+X+N+Y,
                 SZC FELVETELE+Y+M)).

FELSZABADITAS+X+N-X1-N1:
        SUBTR+PFORM+N+PFORM,MAKE+X1+X,MAKE+N1+N,
        ELOTTE SZABAD+X1+N1,UTANA SZABAD+X1+N1,SZC FELVETELE+X1+N1.

ELOTTE SZABAD+X+N-X1-M:
        SUBTR+X+1+X1,HOSSZ+X1+M,SUBTR+X+M+X,ADD+N+M+N,
            (LESS+2+M,SZC TORLESE+X;).

UTANA SZABAD+X+N-X1-M-X2:
        ADD+X+N+X1,HOSSZ+X1+M,ADD+N+M+N;
                   ADD+X1+2+X2,HOSSZ+X2+M,LESS+2+M,ADD+N+M+N,SZC TORLESE+X1.

HOSSZ+X+N:
        GET+LFORM+X+N,SUBTR+N+MINHOSSZ+N,LESS+0+N,LESS+N+MAXFORM.

SZC KAPCSOLASA+X+Y-Y1:
        PUT+LFORM+X+Y,NONEQUAL+Y+0,ADD+Y+1+Y1,PUT+LFORM+Y1+X.

SZC TORLESE+X-Y-Z-X1:
        GET+LFORM+X+Z,ADD+X+1+X1,GET+LFORM+X1+Y,SZC KAPCSOLASA+Y+Z.

PUT HOSSZ+X+N-X1-NM:
        ADD+N+MINHOSSZ+NM,ADD+X+2+X1,PUT+LFORM+X1+NM,
         ADD+X+N+X1,DECR+X1,PUT+LFORM+X1+NM.

GET HOSSZ+X+N-X1:
        ADD+X+2+X1,GET+LFORM+X1+N,SUBTR+N+MINHOSSZ+N.

SZC FELVETELE+X+N-X1-Y-Z:
        LSEQ+N+2,
          (EQUAL+N+1,PUT+LFORM+X+EGY HOSSZU;
           EQUAL+N+2,PUT+LFORM+X+KETTO HOSSZU,
                     ADD+X+1+X1,PUT+LFORM+X1+KETTO HOSSZU);
        SZCLISTA+N+Y,GET+LFORM+Y+Z,
          SZC KAPCSOLASA+Y+X,SZC KAPCSOLASA+X+Z,PUT HOSSZ+X+N.

SZCLISTA+N+Y:
        ADD+MIN SZC+N+Y,LSEQ+Y+MAX SZC;
                        MAKE+Y+X NAGYSZC.

BEALLITASOK-Y-N:
        MAKE+ELLENORZESI SZINT+MARKER,MAKE+ELOJELKONV+PLUSZJEL.
        MAKE+XFORM+MINFFORM,MAKE+PFORM+MAXFORM,
          MAKE+Y+MINFORM,
     ISM: (LSEQ+Y+X NAGY SZC,PUT+LFORM+Y+0,INCR+Y,:ISM;
           PUT+LFORM+MAXFORM+0,
           SUBTR+MAXFORM+MIN F FORM+N,FELSZABADITAS+MIN F FORM+N).
KLOZLISTA-X-VEG:
        MAKE+ELOJELKONV+PLUSZJEL,
          ISM:(KLOZ+X,(BESZAKITAS,HIBAINTEZES,(FALSE);
                       KLOZFUZES+X+VEG,(IS+VEG,SORHUZAS;NEXT SYMBOL,:ISM));
               BESZAKITAS,HIBAINTEZES,(FALSE);
               B HIBA+SZINT,KOMMENT,R+PONTJEL,HIBAINTEZES,:ISM).

HIBAINTEZES:
        TEST+5;MIN+HIBASZINT+ELLENORZESI SZINT+HIBASZINT.

KLOZ+X-ELC:
  ISM: R+CSILLAGJEL,KOMMENT,R+PONTJEL,:ISM;
       VALTKEZDES, LITERALLISTA+ELC,KLOZELINTEZES+X+ELC.

KLOZFUZES+Z+VEG-X-N -Y:
        EGYEDI KLOZ+Z+VEG,KLOZFELSZABADITAS+Z;
        ELSO LITERAL FVNEVE+Z+X,KLOZATNEZES+X+0+X+N+Y,KLOZTOLDAS+X+Z,
         PUT SORSZAMA+Z+N.

KLOZATNEZES+F+N+X+M+Y:
        MAKE+X+F,MAKE+M+1,GETADMIN+X+KLOZ ADMIN+Y,
         ISM:(LESS+0+Y,NONEQUAL+N+M,INCR+M,MAKE+X+Y,KOVKLOZ+Y,:ISM;
             ),

KLOZTOLDAS+Z+Y-Z1:
        WAS SYMB+Z,PUT ADMIN+Z+KLOZ ADMIN+Y;
        ADD+Z+1+Z1,PUT+LFORM+Z1+Y.

KLOZSZAMOZAS+Y+M-X-N:
        MAKE+X+Y,MAKE+N+M,
         ISM:(EQUAL+X+0;
              PUT SORSZAMA+X+N,INCR+N,KOVKLOZ+X,:ISM).

PUT SORSZAMA+KL+N-X:
        ADD+KL+3+X,PUT+LFORM+X+N.
PUT KLL+KL+X-Y:
        ADD+KL+1+Y,PUT+LFORM+Y+X.
KLOZELINTEZES+Z+ELC-X:
        ADDMULT+PVALT+2+FIXMERET+X,(FORMHELY+Z+KLMERET,
        TAROL+Z+0+ELC,TAROL+Z+1+0,TAROL+Z+2+X,TAROL+Z+4+ELLENORZESI SZINT;
                                   LITFELSZABADITAS+ELC,(FALSE)).

LITERALLISTA+ELC-X-ELOZO:
  ELSO LITERAL+ELC, MAKE+ELOZO+ELC,
          ISM: (AHEAD+PONTJEL;
                LITERAL+X, PUT+LFORM+ELOZO+X,     MAKE+ELOZO+X, :ISM ;
                LITFELSZABADITAS+ELC,(FALSE)).
LITERAL+X-Y-Z:
        ELOJEL ELL+MINUSZJEL.
       ELOJEL+Y, (VALTOZO+Z, LITERALINTEZES+X+Y+Z;
                  ATOM+Z, LITERALINTEZES+X+Y+Z).
LITERALINTEZES+X+Y+Z:
       ELOJELINTEZES+Z+Y,
        (FORMHELY+X+LLMERET,TAROL+X+0+0,TAROL+X+1+Z;
         UNMARK+Z+Z,ATOMFELSZABADITAS+Z,(FALSE)).

ELOJEL+Y:
       R+PLUSZJEL, MAKE+Y+1;
       R+MINUSZJEL, MAKE+Y+MARKER.
ELOJELINTEZES+Z+Y:
       (MARKED+Y, MARK+Z; ).

ELSO LITERAL+X-Y-Z:
        ELOJEL ELL+ELOJEL KONV,ELOJEL+Y,ATOM+Z,LITERALINTEZES+X+Y+Z.

EGYEDI KLOZ+X+VEG-AT-F-N:
        SET+VEG+FALSE,POZITIV EGYSEG+X+AT,
          (EQUAL+AT+FINJEL,SET+VEG+TRUE;
           FVNEVE+AT+F,GET NARG+AT+N,
             (EQUAL+F+OPERATORJEL,EQUAL+N+4,OPERATORDEKLARACIO+AT;
             EQUAL+F+SZINTJEL,EQUAL+N+2,SZINTBEALLITAS+AT)).

POZITIV EGYSEG X+AT-Y-Z:
        GET+LFORM+X+Y,GET+LFORM+Y+Z,EQUAL+Z+0,
         GETLIT+Y+AT,'NOT'MARKED+AT,
OPERATORDEKLARACIO+AT-OP-IRANY-PR:
        KOVARG+AT+OP,KOVARG+AT+IRANY,KOVARG+AT+PR,AZONOSITONEVE+OP+OP,
         SZAMKONS+PR+PR,
          (EQUAL+IRANY+JOBBROL BALRA,MARK+PR,PUT ADMIN+OP+OP ADMIN+PR;
           EQUAL+IRANY+BALROL JOBBRA,        PUT ADMIN+OP+OP ADMIN+PR).
SZINTBEALLITAS+AT-N:
        KOVARG+AT+N,SZAMKONS+N+ELLENORZESI SZINT.

FVNEV+X:
        IS TAG+X;
        IS SPEC+X.

'RS'  ATOM+X-Y:
          FVNEV+Y,PARAMETEREK+X+Y.

'RS'  PARAMETEREK+X+Y-N:
          R+NYITOJEL,MAKE+N+1,PMARADEK+X+Y+N;
          KONSTANSELINTEZES+X+Y.

'RS'  PMARADEK+X+OP+N-Y:
          TERM+Y,(PMARADEK1+X+OP+N+Y;
                 ATOMFELSZABADITAS+Y,(FALSE)).

'RS' PMARADEK1+X+OP+N+Y:
        INCR+N,
            (R+VESSZOJEL,PMARADEK+X+OP+N,DECR+N,TAROL+X+N+Y;
             R+VEGZAROJEL,FORMFEJ+X+N+OP,DECR+N,TAROL+X+N+Y).

TAROL+X+N+Y-Z:
        ADD+X+N+Z,PUT+LFORM+Z+Y.

